@use '../../../styles/themes/mixins' as *;
@use '../../../styles/themes/tokens' as *;

// Modern glass effect, better contrast
.navbar {
  @include glass-effect(rgba($bg-primary, 0.98), rgba($border-light, 0.25));
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  z-index: $z-index-navbar;
  display: grid;
  grid-template-columns: 1fr;
  align-items: center;
  min-height: 72px;
  box-shadow: 0 2px 24px rgba($primary-500, 0.08);
  @include smooth-transition(0.3s, cubic-bezier(0.4, 0, 0.2, 1));

  @include mobile-only {
    min-height: 60px;
    padding: $spacing-2 $spacing-2;
    box-shadow: 0 1px 8px rgba($primary-500, 0.10);
  }

  // Left section - Hamburger always visible
  .navbar__left {
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    @include flex-center;
    justify-content: flex-start;
    z-index: $z-index-dropdown + 20;
    padding-left: $spacing-4;

    @include mobile-only {
      padding-left: $spacing-3;
    }
  }

  .navbar__menu-toggle {
    @include button-reset;
    @include smooth-transition;
    width: 48px;
    height: 48px;
    @include flex-center;
    border-radius: $border-radius-lg;
    position: relative;

    &:hover {
      background: rgba($primary-500, 0.08);
      @include hover-lift(2px, 1.03);
    }

    &:active {
      transform: scale(0.95);
    }

    &--open {
      background: rgba($primary-500, 0.12);

      .navbar__menu-icon .bar {
        &:nth-child(1) {
          transform: rotate(45deg) translate(6px, 6px);
          background: $primary-500;
        }
        &:nth-child(2) {
          opacity: 0;
          transform: scale(0);
        }
        &:nth-child(3) {
          transform: rotate(-45deg) translate(8px, -7px);
          background: $primary-500;
        }
      }
    }

    .navbar__menu-icon {
      @include flex-center;
      flex-direction: column;
      width: 24px;
      height: 20px;
      position: relative;

      .bar {
        display: block;
        width: 100%;
        height: 2.5px;
        margin: 2.5px 0;
        border-radius: $border-radius-sm;
        background: $primary-700;
        @include smooth-transition(0.3s, cubic-bezier(0.4, 0, 0.2, 1));

        &:nth-child(1) { width: 100%; }
        &:nth-child(2) { width: 80%; }
        &:nth-child(3) { width: 100%; }
      }
    }
  }

  // Center section - Logo
  .navbar__center {
    grid-column: 1 / -1;
    justify-self: center;
    @include flex-center;
    gap: $spacing-md;
    z-index: $z-index-dropdown + 10;

    .navbar__logo {
      @include smooth-transition;
      filter: drop-shadow(0 2px 8px rgba($primary-500, 0.10));
      &:hover {
        @include hover-lift(2px, 1.07);
        filter: drop-shadow(0 4px 16px rgba($primary-500, 0.18));
      }
    }

    .navbar__site-name {
      @include text-style('body-lg');
      @include text-gradient($primary-500, $primary-700);
      font-weight: $font-weight-semibold;
      letter-spacing: 1px;
      margin-top: 0.1rem;
      text-shadow: 0 1px 8px rgba($primary-500, 0.08);
    }
  }

  // Right section - User/Auth
  .navbar__right {
    position: absolute;
    right: 0;
    top: 0;
    height: 100%;
    @include flex-center;
    justify-content: flex-end;
    gap: $spacing-md;
    z-index: $z-index-dropdown + 20;
    padding-right: $spacing-4;

    @include mobile-only {
      padding-right: $spacing-2;
      gap: $spacing-2;
    }
  }

  // Language Selector
  &__language-selector {
    @include flex-center;

    .language-selector {
      border-radius: $border-radius-md;
      padding: $spacing-2 $spacing-3;
      @include text-style('body-sm');
      @include smooth-transition;

      &:hover {
        background: rgba($bg-primary, 1);
        border-color: $primary-500;
        @include hover-lift(1px, 1.02);
        box-shadow: 0 2px 8px rgba($primary-500, 0.15);
      }

      &--buttons {
        gap: $spacing-xs;

        .language-selector__button {
          padding: $spacing-xs $spacing-sm;
          @include text-style('body-sm');
          border-radius: $border-radius-sm;
          min-width: auto;
          @include smooth-transition;

          &--active {
            @include btn-variant('primary');
            box-shadow: 0 2px 8px rgba($primary-500, 0.3);
          }

          &:hover:not(&--active) {
            background: rgba($primary-500, 0.1);
            color: $primary-600;
          }
        }
      }
    }
  }

  // User section
  &__user {
    @include flex-center;
    gap: $spacing-md;

    @include mobile-only {
      gap: $spacing-2;
    }
  }

  &__greeting {
    @include mobile-only {
      display: none;
    }
  }

  // Profile section
  &__profile {
    position: relative;
    @include flex-center;
    gap: $spacing-sm;
  }

  &__avatar {
    width: 60px;
    height: 60px;
    border-radius: $border-radius-full;
    border: 2px solid rgba($primary-200, 0.5);
    @include smooth-transition;
    object-fit: cover;
    box-shadow: $shadow-sm;

    &:hover {
      border-color: $primary-500;
      box-shadow: 0 4px 16px rgba($primary-500, 0.3);
      @include hover-lift(2px, 1.05);
    }
  }

  &__profile-toggle {
    @include button-reset;
    @include smooth-transition;
    color: $color-text-secondary;
    padding: $spacing-xs;
    border-radius: $border-radius-sm;

    &:hover {
      color: $primary-500;
      background: rgba($primary-500, 0.1);
      transform: scale(1.1);
    }
  }

  &__profile-chevron {
    @include smooth-transition(0.3s, cubic-bezier(0.4, 0, 0.2, 1));
    @include text-style('caption');

    &--open {
      transform: rotate(180deg);
    }
  }

  // Profile dropdown
  &__profile-dropdown {
    position: absolute;
    top: calc(100% + #{$spacing-sm});
    right: 0;
    @include glass-effect(rgba($color-surface, 0.99), rgba($color-border, 0.22));
    border-radius: $border-radius-xl;
    box-shadow: 0 8px 32px rgba($primary-500, 0.18);
    min-width: 280px;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px) scale(0.95);
    @include smooth-transition(0.32s, cubic-bezier(0.4, 0, 0.2, 1));
    z-index: $z-index-dropdown;
    overflow: hidden;

    &--open {
      opacity: 1;
      visibility: visible;
      transform: translateY(0) scale(1);
      box-shadow: 0 16px 48px rgba($primary-500, 0.22);
    }

    @include mobile-only {
      right: -$spacing-2;
      min-width: 220px;
    }
  }

  &__profile-header {
    padding: $spacing-lg;
    border-bottom: 1px solid rgba($color-border, 0.1);
  }

  &__profile-info {
    text-align: left;
  }

  &__profile-name {
    @include text-style('body');
    color: $text-inverse;
    font-weight: $font-weight-semibold;
    margin-bottom: 4px;
  }

  &__profile-email {
    @include text-style('body-sm');
    color: $secondary-400;
    margin-bottom: 4px;
  }

  &__profile-role {
    @include text-style('caption');
    color: $primary-500;
    font-weight: $font-weight-medium;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  &__profile-menu {
    list-style: none;
    margin: 0;
    padding: 1.5rem;
  }

  &__profile-link {
    @include flex-center;
    justify-content: flex-start;
    gap: $spacing-3;
    padding: $spacing-3 $spacing-lg;
    font-weight: $font-weight-medium;
    @include smooth-transition;
    @include button-reset;
    width: 100%;
    color: $primary-700;
    text-align: left;
    cursor: pointer;

    &:hover {
      background: rgba($primary-500, 0.10);
      color: $primary-600;
      transform: translateX(4px);
    }

    &--logout {
      color: $color-danger;

      &:hover {
        background: rgba($color-danger, 0.12);
        color: $color-danger;
      }
    }

    svg {
      width: 18px;
      height: 18px;
      flex-shrink: 0;
    }
  }

  &__profile-divider {
    height: 1px;
    background: rgba($color-border, 0.1);
    margin: $spacing-2 0;
  }

  // Auth section
  &__auth {
    @include flex-center;
    gap: $spacing-4;

    @include mobile-only {
      gap: $spacing-2;
    }
  }

  &__auth-buttons {
    @include flex-center;
    gap: $spacing-3;

    @include mobile-only {
      gap: $spacing-2;
    }
  }

  &__auth-button {
    @include btn-base;
    @include btn-size('sm');
    @include smooth-transition;
    border-radius: $border-radius-lg;
    text-decoration: none;

    @include mobile-only {
      span {
        display: none;
      }
    }

    svg {
      width: 16px;
      height: 16px;
    }

    &--login {
      color: $primary-600;
      @include glass-effect(rgba($primary-50, 0.8), rgba($primary-200, 0.5));

      &:hover {
        background: rgba($primary-100, 1);
        border-color: $primary-300;
        color: $primary-700;
        @include hover-lift(1px, 1.02);
        box-shadow: 0 4px 12px rgba($primary-500, 0.15);
      }
    }

    &--register {
      @include btn-variant('primary');
      box-shadow: 0 2px 8px rgba($primary-500, 0.3);

      &:hover {
        @include hover-lift(2px, 1.02);
        box-shadow: 0 6px 20px rgba($primary-500, 0.4);
      }
    }
  }

  // Hamburger Menu - Full Screen Modern Style
  .navbar__nav {
    position: fixed;
    left: 0;
    top: 0;
    width: 100%;
    height: 100vh;
    @include glass-effect(rgba(255, 255, 255, 0.98), rgba(255, 255, 255, 0.1));
    z-index: $z-index-dropdown + 100;
    transform: translateX(-100%);
    @include smooth-transition(0.4s, cubic-bezier(0.4, 0, 0.2, 1));
    @include flex-center;
    visibility: hidden;
    opacity: 0;

    &--open {
      transform: translateX(0);
      visibility: visible;
      opacity: 1;
    }

    @include mobile-only {
      background: rgba(255, 255, 255, 0.95);
    }
  }

  .navbar__nav-list {
    list-style: none;
    margin: 0;
    padding: 0;
    @include flex-column;
    gap: $spacing-3;
    align-items: center;
    width: 100%;
    max-width: 400px;
    padding: 0 $spacing-6;

    @include mobile-only {
      max-width: 300px;
      padding: 0 $spacing-4;
    }
  }

  .nav-item {
    width: 100%;
    // Suppression de toute animation, transform et opacity pour visibilité immédiate
    transform: none !important;
    opacity: 1 !important;

    &__link {
      @include flex-center;
      justify-content: flex-start;
      gap: $spacing-4;
      padding: $spacing-4 $spacing-5;
      color: $color-text;
      text-decoration: none;
      @include text-style('body-lg');
      font-weight: $font-weight-semibold;
      border-radius: $border-radius-xl;
      @include smooth-transition(0.3s, cubic-bezier(0.4, 0, 0.2, 1));
      @include glass-effect(rgba($bg-primary, 0.8), rgba($border-light, 0.2));
      width: 100%;

      &:hover,
      &--active {
        // Déplacez les déclarations avant les mixins imbriqués
        box-shadow: 0 8px 30px rgba($primary-500, 0.3);
        border-color: transparent;
        @include btn-variant('primary');
        @include hover-lift(2px, 1.02);
      }

      svg {
        width: 24px;
        height: 24px;
        @include smooth-transition;
      }

      @include mobile-only {
        padding: $spacing-3 $spacing-4;
        @include text-style('body');
        gap: $spacing-3;

        svg {
          width: 20px;
          height: 20px;
        }
      }
    }

    // Suppression de l'animation slide-up pour visibilité immédiate
    // @for $i from 1 through 10 {
    //   &:nth-child(#{$i}) {
    //     animation-delay: #{$i * 0.1}s;
    //     animation-fill-mode: forwards;
    //     @include slide-up(0.5s, 30px);
    //   }
    // }
  }

  // Menu open state animation
  &--menu-open {
    .navbar__nav {
      width: 50%;
      .nav-item {
        // Suppression de toute animation sur les nav-items
        transform: none !important;
        opacity: 1 !important;
      }
    }
  }

  // Overlay
  &__overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.3);
    z-index: $z-index-dropdown + 15;
    opacity: 0;
    animation-fill-mode: forwards;
    @include fade-in(0.3s);
  }

  // Loading states
  &__loading {
    @include flex-between;
    width: 100%;
    padding: $spacing-2 0;
  }

  &__auth-loading {
    @include flex-center;
    gap: $spacing-2;

    .loading-spinner {
      width: 20px;
      height: 20px;
      border: 2px solid rgba($primary-200, 0.3);
      border-top: 2px solid $primary-500;
      border-radius: $border-radius-full;
      animation: spin 1s linear infinite;
    }
  }

  // Variants
  &--primary {
    @include glass-effect(rgba($primary-600, 0.95), rgba($primary-500, 0.2));

    .navbar__menu-toggle {
      color: white;

      &:hover {
        background: rgba(white, 0.1);
      }

      &--open {
        background: rgba(white, 0.15);

        .navbar__menu-icon .bar {
          background: white;
        }
      }

      .navbar__menu-icon .bar {
        background: white;
      }
    }

    .navbar__site-name {
      @include text-gradient(white, rgba(white, 0.8));
    }

    .navbar__auth-button--login {
      color: white;
      @include glass-effect(rgba(white, 0.1), rgba(white, 0.2));

      &:hover {
        background: rgba(white, 0.2);
        color: white;
      }
    }

    .navbar__avatar {
      border-color: rgba(white, 0.3);

      &:hover {
        border-color: white;
      }
    }

    .navbar__profile-toggle {
      color: rgba(white, 0.8);

      &:hover {
        color: white;
        background: rgba(white, 0.1);
      }
    }

    .navbar__nav {
      @include glass-effect(rgba($primary-600, 0.98), rgba($primary-500, 0.2));
    }
  }

  &--minimal {
    @include glass-effect(rgba($bg-primary, 0.9), rgba($border-light, 0.1));
    box-shadow: $shadow-sm;

    .navbar__nav {
      @include glass-effect(rgba($color-surface, 0.95), rgba($border-light, 0.1));
    }
  }
}

// Animations
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

// Dark mode support
@media (prefers-color-scheme: dark) {
  .navbar {
    @include glass-effect(rgba($secondary-900, 0.98), rgba($secondary-700, 0.32));
    box-shadow: 0 2px 24px rgba($primary-500, 0.18);

    .navbar__nav {
      @include glass-effect(rgba($secondary-900, 0.99), rgba($secondary-700, 0.22));
    }

    .navbar__nav-list .nav-item__link {
      @include glass-effect(rgba($secondary-800, 0.88), rgba($secondary-600, 0.32));
      color: white;
      text-shadow: 0 1px 8px rgba($primary-500, 0.18);
    }

    .navbar__profile-dropdown {
      @include glass-effect(rgba($secondary-800, 0.99), rgba($secondary-600, 0.22));
      box-shadow: 0 8px 32px rgba($primary-500, 0.28);
    }

    .navbar__auth-button--login {
      @include glass-effect(rgba($secondary-700, 0.88), rgba($secondary-600, 0.52));
      color: white;

      &:hover {
        background: rgba($secondary-600, 0.88);
      }
    }
  }
}

// Accessibility
@media (prefers-reduced-motion: reduce) {
  .navbar,
  .navbar__profile-dropdown,
  .navbar__profile-chevron,
  .navbar__menu-toggle,
  .navbar__profile-toggle,
  .navbar__profile-link,
  .navbar__avatar,
  .navbar__nav,
  .nav-item {
    transition: none;
    animation: none;
  }

  .navbar__nav--open .nav-item {
    width: 50%;
    transform: translateY(0);
    opacity: 1;
  }

  .navbar__overlay {
    animation: none;
    opacity: 1;
  }
}